/// <reference path="../test-typings.d.ts"/>

import fs = require('fs');
import mkdirp = require('mkdirp');


// relative to 'mendixmodelsdk/':
const outputPathPrefix = '.test-output/';
const testDataPathPrefix = './test/data/';


/**
 * Writes the given JSON under the given file name into the integration-tests/node/.test-output directory.
 */
export function writeJson(fileName:string, json:Object) {
	mkdirp(outputPathPrefix, /* trigger default: */ null, err => {
		if (err) {
			console.warn(`could not create path '${outputPathPrefix} for test output`);
		} else {
			fs.writeFile(outputPathPrefix + fileName, JSON.stringify(json, null, 4), { encoding: 'utf-8' }, err => {
				if (err) {
					console.warn(`could not write JSON to '${outputPathPrefix}${fileName}' due to: ${err}`);
				} else {
					console.log(`wrote JSON to ${outputPathPrefix}${fileName}`);
				}
			});
		}
	});
}


/**
 * Reads the given file file name under the integration-tests/node/test/data directory
 * and parses and returns it as JSON.
 */
export function readJson(fileName:string) {
	return JSON.parse(fs.readFileSync(testDataPathPrefix + fileName, 'utf8'));
}

